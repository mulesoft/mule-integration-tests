<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:oauth="http://www.mulesoft.org/schema/mule/oauth"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
        http://www.mulesoft.org/schema/mule/oauth http://www.mulesoft.org/schema/mule/oauth/current/mule-oauth.xsd
        http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
    <oauth:token-manager-config name="tokenManagerConfig"/>

    <http:request-config name="httpRequestConfigWithOAuthProxyInline">
        <http:request-connection host="localhost" port="8081">
            <http:authentication>
                <oauth:client-credentials-grant-type
                        clientId="client-id"
                        clientSecret="client-secret"
                        tokenManager="tokenManagerConfig"
                        scopes="scopes"
                        tokenUrl="token-url"
                        refreshTokenWhen="#[attributes.statusCode == 500]"
                        responseAccessToken="#[payload['access_token']]"
                        responseExpiresIn="#[payload['expires_in']]">
                    <oauth:proxy-config>
                        <http:proxy name="proxyConfig" host="localhost" port="8083" />
                    </oauth:proxy-config>
                </oauth:client-credentials-grant-type>
            </http:authentication>
        </http:request-connection>
    </http:request-config>
</mule>