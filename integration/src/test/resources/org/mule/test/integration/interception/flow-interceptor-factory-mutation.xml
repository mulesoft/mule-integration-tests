<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core"
    xmlns:test="http://www.mulesoft.org/schema/mule/test"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
               http://www.mulesoft.org/schema/mule/test http://www.mulesoft.org/schema/mule/test/current/mule-test.xsd">

    <flow name="mutated">
        <flow-ref name="#[vars.targetFlow]"/>
        
        <choice>
            <when expression="#[vars.targetFlow == 'mutatedAfter' || vars.targetFlow == 'mutatedBeforeAfter']">
                <test:assert expression="#[vars.mutatedAfter != null]"/>
            </when>
            <otherwise>
                <test:assert expression="#[vars.mutatedAfter == null]"/>
            </otherwise>
        </choice>
        
    </flow>

    <flow name="mutatedNone">
        <test:assert expression="#[vars.mutatedBefore == null]"/>
    </flow>

    <flow name="mutatedBefore">
        <test:assert expression="#[vars.mutatedBefore != null]"/>
    </flow>

    <flow name="mutatedAfter">
        <test:assert expression="#[vars.mutatedBefore == null]"/>
    </flow>

    <flow name="mutatedBeforeAfter">
        <test:assert expression="#[vars.mutatedBefore != null]"/>
    </flow>

</mule>
